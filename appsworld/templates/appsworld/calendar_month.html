<style type="text/css">

	#SECTION_CONTAINER {
		padding: 2px;
	}

    .rgba-primary-0 { color: rgba( 48,111,132,1) }	/* Main Primary color */
    .rgba-primary-1 { color: rgba(123,172,188,1) }
    .rgba-primary-2 { color: rgba( 75,134,153,1) }
    .rgba-primary-3 { color: rgba( 27, 92,113,1) }
    .rgba-primary-4 { color: rgba( 11, 70, 89,1) }

    .rgba-complement-0 { color: rgba(211,143, 71,1) }	/* Main Complement color */
    .rgba-complement-1 { color: rgba(255,210,163,1) }
    .rgba-complement-2 { color: rgba(245,182,115,1) }
    .rgba-complement-3 { color: rgba(181,111, 38,1) }
    .rgba-complement-4 { color: rgba(143, 80, 13,1) }

	#CALENDAR_CONTAINER {
		height: 100vh;
		position: relative;
	}
	#CALENDAR_CONTAINER .table {
		border-radius: 10px;
		font-size: 12px;
    	table-layout: fixed;
    	width: 100%;
    	height: 80vh;
	}

	#CALENDAR_CONTAINER .table tr {
		padding: 0px;
		margin: 0px;
	}

	#CALENDAR_CONTAINER .table tr td {
		border-color: rgba( 27, 92,113,1);
		border-width: 1px;
		border-style: solid;
		padding: 0px;
		margin: 0px;
	}

	.month-container thead td {
	    background-color: rgba(48,111,132,1);
	}

	#CALENDAR_CONTAINER .month_name {
		font-size: 32px;
	    color: white;
	}

	#CALENDAR_CONTAINER .day_of_week {
		font-size: 16px;
	    color: rgba( 11, 70, 89,1);
	    background-color: rgba(123,172,188,1);
	    height: 30px;
	}

	.weekend {
		margin: 0px !important;
		padding: 0px !important;
	}
	.weekday {
		margin: 0px !important;
		padding: 0px !important;
	}

	.day_date {
		width: 100%;
		height: 20%;
		border-color: lightgray;
		border-width: 0px;
		border-style: solid;
		border-bottom-width: 1px;
		font-weight: bold;
	}

	.day_morning {
		width: 100%;
		height: 40%;
		border-color: lightgray;
		border-width: 0px;
		border-style: solid;
		border-bottom-width: 1px;
	}

	.day_afternoon {
		width: 100%;
		height: 40%;
		border-color: lightgray;
		border-width: 0px;
		border-style: solid;
		border-bottom-width: 1px;
	}

	.day_of_month {
		padding: 0px !important;
		margin: 0px !important;
		background-color: white;
	}

	.day_label {
		font-size: 16px;
		background-color: white;
		color: rgba( 11, 70, 89,1);
	    margin: 0px;
	    padding: 0px;
	    padding-left: 4px;
	}

	.day_container .day_button {
		padding: 0px;
		margin-top: 4px;
		margin-left: 4px;
		width: 20px;
		height: 20px;
		border-color: transparent;
		background-color: transparent;
	}

	.day_morning, .day_afternoon {
		margin: 0px;
		padding: 0px;
		width: 100%;
		border-width: 0px;
		height: 40%;
	}

	.day_of_month input {
		margin: 0px;
		padding: 0px;
		width: 100%;
		border-width: 0px;
		height: 100%;
	}

	#EVENT_FORM {
		position: absolute;
		top: 40px;
		width: 98%;
		max-width: 600px;
		min-height: 100px;
		max-height: 100vh;
		overflow: auto;
		left: 50%;
		transform: translate(-50%);
		background-color: rgba(240, 240, 240, 0.9);
		border-color: white;
		border-width: 2px;
		border-style: solid;
	}

	#EXIT_BUTTON {
	    width: 20px;
	    height: 20px;
	    padding: 0px;
	}

	.add-event {
	    color: darkgreen;
	    margin-left: 4px;
	    margin-right: 4px;
	}

	.edit_event_button {
		padding: 0px;
		margin: 0px;
		border-color: transparent;
	}

	.edit-event {
		padding: 0px;
		margin: 0px;
		border-color: transparent;
	}

	.event-item {
	    border-color: transparent;
	    border-width: 1px;
	    border-style: solid;
	    border-left-color: blue;
	    border-left-width: 1px;
	    border-left-style: solid;
	    padding: 4px;
	}

    #MONTH_NAVIGATOR button{
        background-color: transparent;
        border-color: transparent;
    }

    #MONTH_NAVIGATOR #DISPLAY_YEAR{
        font-weight: bold;
        background-color: rgb(136,176,75);
        color: white;
    }

    #MONTH_NAVIGATOR .active {
    	font-size: 32px;
    }

</style>
<div id="SECTION_CONTAINER">
	<div class="row">
	    <ul id="MONTH_NAVIGATOR" class="pagination">
	        <li><a id="DISPLAY_YEAR" class="btn btn-info" href="{% url 'view_calendar_year' user year_today %}">Present Year</a></li>
	        <li><a class="btn btn-warning pull-left" onclick="decrementMonth();"><span class="glyphicon glyphicon-arrow-left"></span> Previous</a><li>
	        <li><a href="#" onclick="switchMonth(0);">Jan</a><li>
	        <li><a href="#" onclick="switchMonth(1);">Feb</a><li>
	        <li><a href="#" onclick="switchMonth(2);">Mar</a><li>
	        <li><a href="#" onclick="switchMonth(3);">Apr</a><li>
	        <li><a href="#" onclick="switchMonth(4);">May</a><li>
	        <li><a href="#" onclick="switchMonth(5);">Jun</a><li>
	        <li><a href="#" onclick="switchMonth(6);">Jul</a><li>
	        <li><a href="#" onclick="switchMonth(7);">Aug</a><li>
	        <li><a href="#" onclick="switchMonth(8);">Sep</a><li>
	        <li><a href="#" onclick="switchMonth(9);">Oct</a><li>
	        <li><a href="#" onclick="switchMonth(10);">Nov</a><li>
	        <li><a href="#" onclick="switchMonth(11);">Dec</a><li>
	        <li><a class="btn btn-success pull-right" onclick="incrementMonth();">Next <span class="glyphicon glyphicon-arrow-right"></span></a><li>
	    </ul>
	</div>

    <div id="CALENDAR_CONTAINER">
    		<div class="row">
    			<div id="MONTH_CONTAINER">
    			</div>
    		</div>
    	<div id="EVENT_FORM">
    	<button id="EXIT_BUTTON" class="pull-right"><span class='glyphicon glyphicon-remove'></span></button>
    	{% include 'appsworld/form_leave.html' %}
    	</div>
    </div>
</div>
<script>
var table_container;
var monthContainer;
var innerHTML = "";
var monthDisplay;
var yearToDisplay;
var monthToDisplay;
var dayContainer;
var	monthDisplay;
var	yearDisplay;
var	monthContainer;
var	dayContainer;
var dayLabel;
var	addEvent;
var events;
var dateClicked;
var eventIDClicked;
var dayEvents;
var editEventButtons;

$("#EXIT_BUTTON").on("click", dayButtonClicked);

function getElements(){
	monthDisplay = document.getElementById("DISPLAY_MONTH");
	yearDisplay = document.getElementById("DISPLAY_YEAR");
	monthContainer = document.getElementById("MONTH_CONTAINER");
	dayContainer = document.getElementsByClassName("day_of_month");
	dayLabel = document.getElementsByClassName("day_label");
	addEvent = document.getElementsByClassName("add-event");
	dayEvents = document.getElementsByClassName("day_events");
}

function getCalendarElements(){
	for (var i=0; i< addEvent.length; i++) {
		addEvent[i].addEventListener("click", dayButtonClicked);
	}
}

function dayButtonClicked(e){
    var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
	$("#EVENT_FORM").toggle();
	dateClicked = new Date(yearToDisplay, monthToDisplay, parseInt(indexInClass(e.target))+1);
	$("#EVENT_START_DATE").val(dateClicked.toLocaleDateString("en-US"));
}

function editEventButtonClicked(element){
	$("#EVENT_FORM").toggle();
	eventIDClicked = parseInt(element.id.replace("EDIT_EVENT", ""));
	$("#EVENT_ID").val(events[eventIDClicked].pk);
	$("#EVENT_EVENT").val(events[eventIDClicked].fields.event);
	$("#EVENT_SPEAKER").val(events[eventIDClicked].fields.speaker);
	$("#EVENT_ATTENDEES").val(events[eventIDClicked].fields.attendees);
	var startDate = new Date(events[eventIDClicked].fields.start_date);
	var startDateString = startDate.getMonth() + "/" + startDate.getDate() + "/" + startDate.getFullYear();
	$("#EVENT_START_DATE").val(startDateString);
	$("#EVENT_START_HOUR").val(events[eventIDClicked].fields.start_hour);
	$("#EVENT_START_MINUTE").val(events[eventIDClicked].fields.start_minute);
	var endDate = new Date(events[eventIDClicked].fields.end_date);
	var endDateString = endDate.getMonth() + "/" + endDate.getDate() + "/" + endDate.getFullYear();
	$("#EVENT_END_DATE").val(endDateString);
	$("#EVENT_END_HOUR").val(events[eventIDClicked].fields.end_hour);
	$("#EVENT_END_MINUTE").val(events[eventIDClicked].fields.end_minute);
}

function indexInClass(node) {
  var className = node.className;
  for (var i = 0; i < addEvent.length; i++) {
    if (addEvent[i] == node) {
      return i;
    }
  }
  return node;
}

function wordDay(day) {
	if (day == 0) {
		return "Sun";
	}
	if (day == 1) {
		return "Mon";
	}
	if (day == 2) {
		return "Tue";
	}
	if (day == 3) {
		return "Wed";
	}
	if (day == 4) {
		return "Thu";
	}
	if (day == 5) {
		return "Fri";
	}
	if (day == 6) {
		return "Sat";
	}
}

function wordMonth(month) {
	if (month == 0) {
		return "January";
	}
	if (month == 1) {
		return "February";
	}
	if (month == 2) {
		return "March";
	}
	if (month == 3) {
		return "April";
	}
	if (month == 4) {
		return "May";
	}
	if (month == 5) {
		return "June";
	}
	if (month == 6) {
		return "July";
	}
	if (month == 7) {
		return "August";
	}
	if (month == 8) {
		return "September";
	}
	if (month == 9) {
		return "October";
	}
	if (month == 10) {
		return "November";
	}
	if (month == 11) {
		return "December";
	}
}

function innerHtmlCalendarDayLess(year, month, day){
	var innerHTML = "";
	var id = year + "_" + month + "_" + day ;
	var date = new Date(year, month, day);
	var day_class;
	if (date.getDay() == 0 | date.getDay() == 6) {
		day_class = "weekend";
	}
	else {
		day_class = "weekday";
	}

	innerHTML += "<div class='day_container " + day_class + "'><div><span class='day_label'>" + day + "</span><button class='day_button'><span class='glyphicon glyphicon-tasks add-event'></span></button></div><div class='day_events'></div></div>";

	return innerHTML;
}


function innerHtmlCalendarMonth(year, month) {
	var innerHTML = "";
	var startDate = new Date(year, month, 1);
	var startDay = startDate.getDay();
	var endDate;
	if (month < 12) {
		endDate = new Date(year, month+1, 0);
	}
	else {
		endDate = new Date(year+1, 0, 0);
	}
	var endDay = endDate.getDate();
	var dayCount = 1;
	var innerHTML = "<div class='month-container'><table class='table table-bordered'><thead><td colspan='7' align='center'><a class='month_name'>" + wordMonth(month) + "</a></td></thead>";
	innerHTML += "<tr class='week_row'>";
	for (j=0; j<7; ++j) {
		innerHTML += "<td class='day_of_week'><b>" + wordDay(j) + "</b></td>";
	}
	innerHTML += "</tr>";
	for (i=0; i<6; ++i) {
		innerHTML += "<tr>";
		for (j=0; j<7; ++j) {
			if (j == startDay%7 & dayCount <= endDay) {
				innerHTML += "<td class='day_of_month'></td>";
				dayCount += 1;
				startDay += 1;
			}
			else {
				innerHTML += "<td class='not_day_of_month'></td>";
			}

		}
		innerHTML += "</tr>";
	}
	innerHTML += "</table></div>";
	return innerHTML;
}


function incrementMonth(){
	if (monthToDisplay >= 11) {
		monthToDisplay = 0;
		yearToDisplay = yearToDisplay + 1;
	}
	else {
		monthToDisplay = parseInt(monthToDisplay) + 1;
	}

	yearDisplay.innerHTML = yearToDisplay;
	createCalendar(monthContainer, yearToDisplay, monthToDisplay, 1);
    putEvents();
}

function decrementMonth(){
	if (monthToDisplay <= 0) {
		monthToDisplay = 11;
		yearToDisplay = yearToDisplay - 1;
	}
	else {
		monthToDisplay = parseInt(monthToDisplay) - 1;
	}
	yearDisplay.innerHTML = yearToDisplay;
	createCalendar(monthContainer, yearToDisplay, monthToDisplay, 1);
	putEvents();
}

function switchMonth(month_index){
    monthToDisplay = parseInt(month_index);
	yearDisplay.innerHTML = yearToDisplay;
	createCalendar(monthContainer, yearToDisplay, monthToDisplay, 1);
	putEvents();
}


function createCalendar(container, year, month, day) {
	monthContainer.innerHTML = innerHtmlCalendarMonth(year, month);
	for (i=1; i<32; ++i) {
		dayContainer[i-1].innerHTML = innerHtmlCalendarDayLess(year, month, i);
	}
	getCalendarElements();
}

function putEvents() {
    var eventCount = Object.keys(events).length;
	for (var i=0; i< dayLabel.length; i++){
		for (var j = 0; j < eventCount; j++) {
		    date = new Date(events[j].fields.start_date)
			if (i==date.getDate()-1 && monthToDisplay == date.getMonth() && yearToDisplay==date.getFullYear()) {
			    buttonId = "EDIT_EVENT" + j;
			    minutes = "0" + date.getMinutes();
			    minutes = minutes.slice(-2)
				dayEvents[i].innerHTML = dayEvents[i].innerHTML + "<h6 class='event-item'><button id='" + buttonId + "' class='edit_event_button' onclick='editEventButtonClicked(this)'><span class='glyphicon glyphicon-edit edit-event'></span></button>" + "<b>" + date.getHours() + ":" + minutes + " </b>" + "<a class='event" + events[j].fields.id + "'>" + events[j].fields.event + "</a></h6>";
			}
		}
	}
}

function passVariables(){
	events = {{list_of_events | safe}};
}

function main() {
	passVariables();
	getElements();
	$("#EVENT_FORM").hide();
	var currentDate = new Date();
	monthToDisplay = {{month}};
	yearToDisplay = {{year_today}};
	yearDisplay.innerHTML = yearToDisplay;
	createCalendar(monthContainer, yearToDisplay, monthToDisplay, 1);
	getCalendarElements();
	putEvents();
}

window.onload = main();
</script>

